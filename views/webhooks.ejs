<!DOCTYPE html>
<html lang="en">
<%- include('partials/_head.ejs') %>
<body>
<%- include('partials/_header.ejs') %>
<main role="main" class="container mt-5">
    <h2>Manage Webhooks</h2>
    <p>Configure endpoints to receive notifications for events.</p>

    <!-- Create New Webhook Form -->
    <div class="card mb-4">
        <div class="card-header">
            Create New Webhook Endpoint
        </div>
        <div class="card-body">
            <form action="/webhooks" method="POST">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <div class="mb-3">
                    <label for="url" class="form-label">Endpoint URL</label>
                    <input type="url" name="url" id="url" class="form-control" placeholder="https://example.com/webhook" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Subscribed Events</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="subscribed_topics" value="response.created" id="topic-response-created">
                        <label class="form-check-label" for="topic-response-created">
                            New Response Created (response.created)
                        </label>
                    </div>
                    <!-- Add more topics here as they become available -->
                </div>
                <button type="submit" class="btn btn-primary">Create Endpoint</button>
            </form>
        </div>
    </div>

    <!-- Existing Endpoints List -->
    <h3>Your Endpoints</h3>
    <table class="table">
        <thead>
            <tr>
                <th>URL</th>
                <th>Secret</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% endpoints.forEach(endpoint => { %>
                <tr>
                    <td><%= endpoint.url %></td>
                    <td><code><%= endpoint.secret %></code></td>
                    <td><span class="badge bg-<%= endpoint.status === 'active' ? 'success' : 'secondary' %>"><%= endpoint.status %></span></td>
                    <td>
                        <form action="/webhooks/<%= endpoint._id %>/delete" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this endpoint?');">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                </tr>
            <% }); %>
            <% if (endpoints.length === 0) { %>
                <tr>
                    <td colspan="4" class="text-center">No webhook endpoints configured.</td>
                </tr>
            <% } %>
        </tbody>
    </table>

</main>
<%- include('partials/_footer.ejs') %>
</body>
</html>
